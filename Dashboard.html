<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KhetSaathi Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #2B9348;
      --primary-dark: #207436;
      --bg-light: #f5f5f5;
      --bg-dark: #1c1c1c;
      --text-light: #fff;
      --text-dark: #222;
      --card-bg-light: #fff;
      --card-bg-dark: #232323;
      --card-shadow: 0px 3px 8px rgba(0,0,0,0.08);
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }
    body {
      background: var(--bg-light);
      color: var(--text-dark);
      min-height: 100vh;
      line-height: 1.6;
      transition: background 0.2s, color 0.2s;
    }
    .dark-mode {
      background: var(--bg-dark);
      color: var(--text-light);
    }
    /* Overlay for sidebar */
    .overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.3);
      z-index: 9;
      transition: opacity 0.2s;
    }
    .overlay.active {
      display: block;
    }
    /* NAVBAR */
    nav.navbar {
      background: var(--primary);
      color: var(--text-light);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 20px;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .profile {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .profile img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #fff;
      object-fit: cover;
    }
    .logo {
      font-size: 22px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
      letter-spacing: 0.5px;
    }
    .hamburger {
      font-size: 26px;
      cursor: pointer;
      background: none;
      color: inherit;
      border: none;
      padding: 0 8px;
      min-width: 44px;
      min-height: 44px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      transition: background 0.2s;
    }
    .hamburger:focus-visible {
      outline: 3px solid #fff;
      outline-offset: 2px;
      background: var(--primary-dark);
    }
    /* SIDEBAR */
    aside.sidebar {
      position: fixed;
      top: 0;
      right: -270px;
      width: 260px;
      height: 100%;
      background: var(--primary);
      color: var(--text-light);
      padding: 24px 20px;
      box-shadow: -2px 0 10px rgba(0,0,0,0.05);
      transition: right 0.3s;
      display: flex;
      flex-direction: column;
      gap: 28px;
      z-index: 15;
    }
    aside.sidebar.active {
      right: 0;
    }
    aside.sidebar nav {
      display: flex;
      flex-direction: column;
      gap: 18px;
    }
    aside.sidebar a {
      color: var(--text-light);
      text-decoration: none;
      font-size: 17px;
      font-weight: 600;
      padding: 8px 0;
      border-radius: 4px;
      transition: background 0.15s;
      min-height: 44px;
    }
    aside.sidebar a:focus-visible,
    aside.sidebar a:hover {
      outline: 2px solid #fff;
      background: var(--primary-dark);
    }
    /* Close button for sidebar */
    .close-btn {
      align-self: flex-end;
      color: #fff;
      background: none;
      border: none;
      font-size: 28px;
      cursor: pointer;
      min-width: 44px;
      min-height: 44px;
    }
    .close-btn:focus-visible {
      outline: 2px solid #fff;
      background: var(--primary-dark);
    }
    /* MAIN CONTENT */
    main.container {
      padding: 24px 32px 24px 32px;
      max-width: 1250px;
      margin: 0 auto;
      margin-top: 16px;
    }
    /* Section Headings */
    h2 {
      margin-bottom: 12px;
      color: var(--primary);
      font-weight: 700;
      font-size: 1.35em;
    }
    .dark-mode h2 {
      color: #7effa5;
    }
    /* Card styles */
    .card {
      background: var(--card-bg-light);
      padding: 16px;
      border-radius: 14px;
      margin-bottom: 26px;
      box-shadow: var(--card-shadow);
      transition: background 0.2s, color 0.2s;
    }
    .dark-mode .card {
      background: var(--card-bg-dark);
      color: var(--text-light);
      box-shadow: 0 2px 6px rgba(0,0,0,0.10);
    }
    /* Crop Recommendation */
    .crop-section .khet-controls {
      margin-bottom: 15px;
      display: flex;
      gap: 15px;
    }
    .khet-controls select, .khet-controls button {
      font: inherit;
      border-radius: 8px;
      border: 1px solid #ccc;
      padding: 7px 12px;
      min-width: 120px;
      transition: border 0.2s, background 0.2s;
    }
    .khet-controls button {
      background: var(--primary);
      border: none;
      color: #fff;
      cursor: pointer;
      font-weight: 600;
    }
    .khet-controls button:focus-visible {
      outline: 2px solid var(--primary-dark);
      background: var(--primary-dark);
    }
    /* Crop Cards Grid */
    .crop-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 18px;
    }
    .crop-card {
      background: #f9f9f9;
      border-radius: 10px;
      padding: 12px 8px 10px;
      cursor: pointer;
      text-align: center;
      min-height: 180px;
      transition: box-shadow 0.16s, scale 0.16s;
      box-shadow: 0 1px 4px rgba(43,147,72,0.07);
    }
    .crop-card:hover, .crop-card:focus-visible {
      box-shadow: 0 3px 14px rgba(43,147,72,0.20);
      scale: 1.03;
      outline: 2px solid var(--primary);
    }
    .crop-card img {
      width: 80%;
      border-radius: 8px;
      margin-bottom: 7px;
      object-fit: cover;
      max-height: 80px;
    }
    .crop-card h3 {
      font-size: 1.12em;
      margin: 4px 0 2px;
      font-weight: 600;
    }
    /* Weather */
    .weather-widget {
      display: flex;
      gap: 15px;
      overflow-x: auto;
      padding-bottom: 6px;
    }
    .weather-day {
      background: #f9f9f9;
      padding: 10px 14px;
      border-radius: 10px;
      min-width: 120px;
      text-align: center;
      transition: box-shadow 0.13s;
      box-shadow: 0 2px 4px rgba(0,0,0,0.08);
    }
    /* Mandi */
    .mandi-item {
      margin-bottom: 18px;
    }
    .mandi-item strong {
      cursor: pointer;
      color: var(--primary);
      font-size: 1.07em;
      transition: color 0.15s;
      display: inline-block;
      min-height: 36px;
    }
    .mandi-item strong:focus-visible, .mandi-item strong:hover {
      color: #147f34;
      text-decoration: underline;
      outline: 1.5px solid #aedebf;
    }
    .mandi-table {
      display: none;
      margin-top: 7px;
      border-collapse: collapse;
      width: 98%;
      background: #f4f9f4;
      border-radius: 7px;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(43,147,72,0.03);
    }
    .mandi-table th, .mandi-table td {
      border: 1px solid #ccc;
      padding: 7px 10px;
      font-size: 15px;
      text-align: left;
    }
    .mandi-table th {
      background: #d2f5e3;
      color: #153a28;
    }
    /* Responsive tweaks */
    @media (max-width: 900px) {
      main.container {
        padding: 18px 6vw;
      }
    }
    @media (max-width: 600px) {
      nav.navbar {
        flex-direction: column;
        align-items: flex-start;
        gap: 6px;
        padding: 10px 8px 12px;
      }
      aside.sidebar {
        width: 91vw;
        padding: 18px 10px;
      }
      .container {
        padding: 10px 2vw;
      }
      .crop-card img,
      .weather-day {
        min-width: 85px;
        padding-left: 0;
        padding-right: 0;
      }
    }
    /* Focus outline general */
    :focus-visible {
      outline: 2.5px solid #388e53;
      outline-offset: 2.5px;
    }
    /* Dark Mode components */
    .dark-mode .crop-card,
    .dark-mode .weather-day,
    .dark-mode .mandi-table {
      background: #222933;
      color: #effee9;
      border-color: #0d2a15;
    }
    .dark-mode .mandi-table th {
      background: #297e4f;
      color: #fff;
    }
    /* Hide default outline of buttons to use focus-visible */
    button:focus:not(:focus-visible) {
      outline: none;
    }
    .modal-overlay {
    position: fixed;
    z-index: 45;
    left: 0; top: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.35);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: opacity 0.18s;
    }
    .modal-card {
    background: #fff;
    color: #222;
    padding: 32px 26px 24px;
    border-radius: 12px;
    max-width: 370px;
    box-shadow: 0 6px 30px rgba(43,147,72,0.13);
    position: relative;
    min-width: 270px;
    text-align: left;
    }
    .modal-close {
    position: absolute;
    top: 13px; right: 18px;
    font-size: 25px;
    background: none;
    color: #222;
    border: none;
    cursor: pointer;
    min-width: 36px;
    min-height: 36px;
    }
    .dark-mode .modal-card {
    background: #232323;
    color: #f5f5f5;
    }

  </style>
</head>
<body>
  <!-- NAVBAR -->
  <nav class="navbar" aria-label="Main">
    <div class="profile">
      <img src="https://randomuser.me/api/portraits/men/31.jpg" alt="Profile photo of Farmer Ram">
      <span>Farmer Ram</span>
    </div>
    <div class="logo" aria-label="KhetSaathi logo">üåæ KhetSaathi</div>
    <button class="hamburger" aria-label="Open sidebar" aria-controls="sidebar" aria-expanded="false" onclick="toggleSidebar(event)">‚ò∞</button>
  </nav>
  <!-- SIDEBAR & OVERLAY -->
  <aside class="sidebar" id="sidebar" aria-label="Sidebar navigation" tabindex="-1">
    <button class="close-btn" aria-label="Close sidebar" onclick="toggleSidebar(event)">&times;</button>
    <nav>
      <a href="#" tabindex="0">üåê Language</a>
      <a href="#" tabindex="0" onclick="toggleDarkMode(); return false;">üåô Dark/Light Mode</a>
      <a href="#" tabindex="0">üö™ Logout</a>
      <a href="Community_chat.html" tabindex="0">üí¨ Community Chat</a>
      <a href="#" tabindex="0">ü§ñ AI Chat</a>
    </nav>
  </aside>
  <div class="overlay" id="sidebarOverlay" tabindex="-1"></div>
  <!-- MAIN CONTENT -->
  <main class="container" id="mainContent">
    <!-- Crop Recommendation -->
    <section class="card crop-section">
      <h2>üåæ Crop Recommendations</h2>
      <div class="khet-controls">
        <select aria-label="Select Khet">
          <option>Select Khet</option>
          <option>Khet 1</option>
          <option>Khet 2</option>
        </select>
        <button onclick="addKhet()" aria-label="Add New Khet">+ Add New Khet</button>
      </div>
      <div class="crop-cards">
        <button class="crop-card" onclick="showCropDetails('Wheat')" tabindex="0" aria-label="View Wheat Details">
          <img src="https://images.unsplash.com/photo-1502741338009-cac2772e18bc?auto=format&fit=crop&w=400&q=80" alt="Field of Wheat">
          <h3>Wheat</h3>
          <p>Rabi | 120 days</p>
        </button>
        <button class="crop-card" onclick="showCropDetails('Rice')" tabindex="0" aria-label="View Rice Details">
          <img src="https://images.unsplash.com/photo-1439122955806-6c6a0def9947?auto=format&fit=crop&w=400&q=80" alt="Rice paddies">
          <h3>Rice</h3>
          <p>Kharif | 150 days</p>
        </button>
        <button class="crop-card" onclick="showCropDetails('Maize')" tabindex="0" aria-label="View Maize Details">
          <img src="maize.png" alt="Maize field">
          <h3>Maize</h3>
          <p>Zaid | 90 days</p>
        </button>
      </div>
      <!-- Crop Details Modal -->
    <div id="cropModal" class="modal-overlay" tabindex="-1" aria-modal="true" aria-labelledby="cropModalTitle" aria-hidden="true" style="display:none">
    <div class="modal-card" role="dialog">
        <button class="modal-close" aria-label="Close crop details" onclick="closeModal()">&times;</button>
        <div id="modalContent"></div>
    </div>
    </div>

    </section>
    <!-- Weather Section -->
    <section class="card weather-section">
      <h2>üå¶ Weather Forecast</h2>
      <div class="weather-widget" role="list">
        <div class="weather-day" role="listitem" aria-label="Today: 32¬∞C, Sunny, 65% humidity, 10% rain">
          <strong>Today</strong><br>32¬∞C<br>‚òÄÔ∏è<br>Humidity: 65%<br>Rain: 10%
        </div>
        <div class="weather-day" role="listitem" aria-label="Tomorrow: 30¬∞C, Partly cloudy, 70% humidity, 20% rain">
          <strong>Tomorrow</strong><br>30¬∞C<br>‚õÖ<br>Humidity: 70%<br>Rain: 20%
        </div>
        <div class="weather-day" role="listitem" aria-label="Day 3: 29¬∞C, Rainy, 80% humidity, 50% rain">
          <strong>Day 3</strong><br>29¬∞C<br>üåß<br>Humidity: 80%<br>Rain: 50%
        </div>
      </div>
    </section>
    <!-- Mandi Section -->
    <section class="card mandi-section">
      <h2>üè¨ Nearby Mandi</h2>
      <div class="mandi-item">
        <strong tabindex="0" aria-label="Toggle Indore Mandi prices" onclick="toggleMandi('mandi1')" onkeypress="mandiKey(event, 'mandi1')">Indore Mandi</strong>
        <table class="mandi-table" id="mandi1" aria-label="Indore Mandi Prices">
          <tr><th>Crop</th><th>Price (‚Çπ/Quintal)</th></tr>
          <tr><td>Wheat</td><td>2000</td></tr>
          <tr><td>Rice</td><td>2500</td></tr>
          <tr><td>Maize</td><td>1800</td></tr>
        </table>
      </div>
      <div class="mandi-item">
        <strong tabindex="0" aria-label="Toggle Bhopal Mandi prices" onclick="toggleMandi('mandi2')" onkeypress="mandiKey(event, 'mandi2')">Bhopal Mandi</strong>
        <table class="mandi-table" id="mandi2" aria-label="Bhopal Mandi Prices">
          <tr><th>Crop</th><th>Price (‚Çπ/Quintal)</th></tr>
          <tr><td>Soybean</td><td>4000</td></tr>
          <tr><td>Wheat</td><td>2100</td></tr>
          <tr><td>Rice</td><td>2600</td></tr>
        </table>
      </div>
    </section>
  </main>
  <!-- JS -->
  <script>
    // Sidebar logic with overlay and accessibility
    function toggleSidebar(event) {
      const sidebar = document.getElementById("sidebar");
      const overlay = document.getElementById("sidebarOverlay");
      const isActive = sidebar.classList.toggle("active");
      overlay.classList.toggle("active", isActive);
      document.body.style.overflow = isActive ? 'hidden' : '';
      // Update aria-expanded
      const hamb = document.querySelector('.hamburger');
      if(hamb) hamb.setAttribute('aria-expanded', isActive);
      // Trap focus in sidebar
      if(isActive) {
        sidebar.focus();
      }
      if(event) event.stopPropagation();
    }
    // Close sidebar with ESC or overlay click
    window.addEventListener('keydown', function(e) {
      const sidebar = document.getElementById("sidebar");
      if(e.key === "Escape" && sidebar.classList.contains("active")) {
        toggleSidebar();
      }
    });
    document.getElementById("sidebarOverlay").addEventListener('click', function() {
      toggleSidebar();
    });

    // Dark mode toggle
    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      // Optionally store in localStorage:
      // if(document.body.classList.contains('dark-mode')) {
      //   localStorage.setItem('theme', 'dark');
      // } else {
      //   localStorage.setItem('theme', 'light');
      // }
    }
    // Show Crop Details
    function showCropDetails(crop) {
    const data = {
        "Wheat": {
        img: "https://images.unsplash.com/photo-1502741338009-cac2772e18bc?auto=format&fit=crop&w=400&q=80",
        season: "Rabi",
        duration: "120 days",
        tips: "Sow in cool season, irrigate adequately, use certified seeds."
        },
        "Rice": {
        img: "https://images.unsplash.com/photo-1439122955806-6c6a0def9947?auto=format&fit=crop&w=400&q=80",
        season: "Kharif",
        duration: "150 days",
        tips: "Needs standing water, warm climate, pest surveillance needed."
        },
        "Maize": {
        img: "maize.png",
        season: "Zaid",
        duration: "90 days",
        tips: "Requires good sunlight, avoid waterlogging, manage weeds early."
        }
    }[crop];

    if (!data) return;

    const content = `
        <h3 id="cropModalTitle" style="margin-bottom:6px; font-size:1.3em;">${crop}</h3>
        <img src="${data.img}" alt="${crop}" style="width:100%; border-radius:8px; margin-bottom:10px; max-height:150px; object-fit:cover;">
        <p><strong>Season:</strong> ${data.season}</p>
        <p><strong>Duration:</strong> ${data.duration}</p>
        <p><strong>Tips:</strong> ${data.tips}</p>
    `;
    document.getElementById('modalContent').innerHTML = content;
    const modal = document.getElementById('cropModal');
    modal.style.display = 'flex';
    modal.setAttribute("aria-hidden", "false");
    setTimeout(() => { modal.focus(); }, 100);
    }

    // Close modal function
    function closeModal() {
    const modal = document.getElementById('cropModal');
    modal.style.display = 'none';
    modal.setAttribute("aria-hidden", "true");
    }
    // Also allow ESC key and backdrop click to close
    document.getElementById('cropModal').addEventListener('click', function(e) {
    if (e.target === this) closeModal();
    });
    window.addEventListener('keydown', function(e) {
    const modal = document.getElementById('cropModal');
    if (modal.style.display !== 'none' && e.key === 'Escape') {
        closeModal();
    }
    });

    // Add Khet mock
    function addKhet() {
      alert("Add Khet Form (mock). This will later ask for soil type, irrigation source, etc.");
    }
    // Toggle mandi tables with keyboard support and accessibility
    function toggleMandi(id) {
      let table = document.getElementById(id);
      table.style.display = (table.style.display === "table") ? "none" : "table";
    }
    function mandiKey(e, id) {
      if(e.key === "Enter" || e.key === " ") {
        toggleMandi(id);
        e.preventDefault();
      }
    }
    // Optional: restore theme from localStorage if you want persistence
    // window.onload = function() {
    //   if(localStorage.getItem('theme') === 'dark') {
    //     document.body.classList.add('dark-mode');
    //   }
    // };
  </script>
</body>
</html>
